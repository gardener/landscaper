deployItems:
  - name: landscaper-rbac
    type: landscaper.gardener.cloud/helm
    target:
      import: virtualCluster
    config:
      apiVersion: helm.deployer.landscaper.gardener.cloud/v1alpha1
      kind: ProviderConfiguration
      updateStrategy: patch
      name: landscaper-rbac
      namespace: {{ .imports.virtualClusterNamespace }}

      chart:
        {{ $resource := getResource .cd "name" "landscaper-controller-rbac-chart" }}
        ref: {{ $resource.access.imageReference }}

      values:
        namespace:
          create: true

        global:
          serviceAccount:
            controller:
              create: true
              annotations: {}
              name: landscaper-controller

            webhooksServer:
              create: true
              annotations: {}
              name: landscaper-webhooks

            user:
              create: true
              annotations: {}
              name: landscaper-user

      exports:
        defaultTimeout: 10m
        exports:
        - key: landscaperControllerToken
          timeout: 10m
          jsonPath: ".data.token"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-controller-token
            namespace: {{ .imports.virtualClusterNamespace }}

        - key: landscaperControllerCaCrt
          timeout: 10m
          jsonPath: ".data.ca\\.crt"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-controller-token
            namespace: {{ .imports.virtualClusterNamespace }}

        - key: landscaperWebhooksToken
          timeout: 10m
          jsonPath: ".data.token"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-webhooks-token
            namespace: {{ .imports.virtualClusterNamespace }}

        - key: landscaperWebhooksCaCrt
          timeout: 10m
          jsonPath: ".data.ca\\.crt"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-webhooks-token
            namespace: {{ .imports.virtualClusterNamespace }}

        - key: landscaperUserToken
          timeout: 10m
          jsonPath: ".data.token"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-user-token
            namespace: {{ .imports.virtualClusterNamespace }}

        - key: landscaperUserCaCrt
          timeout: 10m
          jsonPath: ".data.ca\\.crt"
          fromResource:
            apiVersion: v1
            kind: Secret
            name: landscaper-user-token
            namespace: {{ .imports.virtualClusterNamespace }}
